<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.231">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Longitudinal Analysis for Surveillance - 1&nbsp; Reference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/200-one-area-no-autocorrelation.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-block .quarto-title-banner {
      color: #000000;
background: #b8e2f2;
    }
    </style>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reference</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reference</span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="https://www.csids.no/resources.html">csids.no</a>
        <div class="sidebar-tools-main">
    <a href="https://github.com/csids/longitudinal-analysis-for-surveillance" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Longitudinal Analysis for Surveillance</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/100-reference.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Reference</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/200-one-area-no-autocorrelation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Panel data: One area without autocorrelation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/300-one-area-with-autocorrelation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Panel data: One area with autocorrelation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/400-multiple-areas-no-panel-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Not panel data: Multiple areas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/500-multiple-areas-no-autocorrelation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Panel data: multiple areas without autocorrelation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/600-multiple-areas-with-autocorrelation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Panel data: multiple areas with autocorrelation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/700-exercises.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/800-solutions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Solutions</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1.1</span>  Introduction</a></li>
  <li><a href="#method-summary" id="toc-method-summary" class="nav-link" data-scroll-target="#method-summary"><span class="toc-section-number">1.2</span>  Method summary</a>
  <ul class="collapse">
  <li><a href="#panel-data-one-geographical-area-no-autocorrelation" id="toc-panel-data-one-geographical-area-no-autocorrelation" class="nav-link" data-scroll-target="#panel-data-one-geographical-area-no-autocorrelation"><span class="toc-section-number">1.2.1</span>  Panel data: One geographical area, no autocorrelation</a></li>
  <li><a href="#panel-data-one-geographical-area-with-autocorrelation" id="toc-panel-data-one-geographical-area-with-autocorrelation" class="nav-link" data-scroll-target="#panel-data-one-geographical-area-with-autocorrelation"><span class="toc-section-number">1.2.2</span>  Panel data: One geographical area, with autocorrelation</a></li>
  <li><a href="#not-panel-data-multiple-geographical-areas" id="toc-not-panel-data-multiple-geographical-areas" class="nav-link" data-scroll-target="#not-panel-data-multiple-geographical-areas"><span class="toc-section-number">1.2.3</span>  Not panel data: Multiple geographical areas</a></li>
  <li><a href="#panel-data-multiple-geographical-areas-no-autocorrelation" id="toc-panel-data-multiple-geographical-areas-no-autocorrelation" class="nav-link" data-scroll-target="#panel-data-multiple-geographical-areas-no-autocorrelation"><span class="toc-section-number">1.2.4</span>  Panel data: Multiple geographical areas, no autocorrelation</a></li>
  <li><a href="#panel-data-multiple-geographical-areas-with-autocorrelation" id="toc-panel-data-multiple-geographical-areas-with-autocorrelation" class="nav-link" data-scroll-target="#panel-data-multiple-geographical-areas-with-autocorrelation"><span class="toc-section-number">1.2.5</span>  Panel data: Multiple geographical areas, with autocorrelation</a></li>
  </ul></li>
  <li><a href="#identifying-your-scenario" id="toc-identifying-your-scenario" class="nav-link" data-scroll-target="#identifying-your-scenario"><span class="toc-section-number">1.3</span>  Identifying your scenario</a>
  <ul class="collapse">
  <li><a href="#step-1-do-you-have-panel-data" id="toc-step-1-do-you-have-panel-data" class="nav-link" data-scroll-target="#step-1-do-you-have-panel-data"><span class="toc-section-number">1.3.1</span>  Step 1: Do you have panel data?</a></li>
  <li><a href="#step-2-do-you-have-multiple-geographical-areas" id="toc-step-2-do-you-have-multiple-geographical-areas" class="nav-link" data-scroll-target="#step-2-do-you-have-multiple-geographical-areas"><span class="toc-section-number">1.3.2</span>  Step 2: Do you have multiple geographical areas?</a></li>
  <li><a href="#step-3-do-you-have-autocorrelation" id="toc-step-3-do-you-have-autocorrelation" class="nav-link" data-scroll-target="#step-3-do-you-have-autocorrelation"><span class="toc-section-number">1.3.3</span>  Step 3: Do you have autocorrelation?</a></li>
  <li><a href="#ar1-data" id="toc-ar1-data" class="nav-link" data-scroll-target="#ar1-data"><span class="toc-section-number">1.3.4</span>  AR(1) data</a></li>
  <li><a href="#ar2-data" id="toc-ar2-data" class="nav-link" data-scroll-target="#ar2-data"><span class="toc-section-number">1.3.5</span>  AR(2) data</a></li>
  <li><a href="#ma1-data" id="toc-ma1-data" class="nav-link" data-scroll-target="#ma1-data"><span class="toc-section-number">1.3.6</span>  MA(1) data</a></li>
  <li><a href="#ma2-data" id="toc-ma2-data" class="nav-link" data-scroll-target="#ma2-data"><span class="toc-section-number">1.3.7</span>  MA(2) data</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/csids/longitudinal-analysis-for-surveillance/edit/main/qmd/100-reference.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/csids/longitudinal-analysis-for-surveillance/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1.1</span> Introduction</h2>
<p>There are two important definitions in this course:</p>
<ul>
<li>Panel data</li>
<li>Autocorrelation</li>
</ul>
<p>Panel data is a set of data with measurements repeated at equally spaced points. For example, weight data recorded every day, or every week, or every year would be considered panel data. A person who records three weight measurements randomly in 2018 would not be considered panel data.</p>
<p>When you have panel data, autocorrelation is the correlation between subsequent observations. For example, if you have daily observations, then the 1 day autocorrelation is the correlation between observations 1 day apart, and likewise the 2 day autocorrelation is the correlation between observations 2 days apart.</p>
<p>In this course we will consider 5 scenarios where we have multiple observations for each geographical area:</p>
<ul>
<li>Panel data: One geographical area, no autocorrelation</li>
<li>Panel data: One geographical area, with autocorrelation</li>
<li>Not panel data: Multiple geographical areas</li>
<li>Panel data: Multiple geographical areas, no autocorrelation</li>
<li>Panel data: Multiple geographical areas, with autocorrelation</li>
</ul>
<p>Note, the following scenario can be covered by standard regression models:</p>
<ul>
<li>Multiple geographical areas, one time point/observation per geographical area</li>
</ul>
<div style="page-break-after: always;"></div>
</section>
<section id="method-summary" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="method-summary"><span class="header-section-number">1.2</span> Method summary</h2>
<section id="panel-data-one-geographical-area-no-autocorrelation" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="panel-data-one-geographical-area-no-autocorrelation"><span class="header-section-number">1.2.1</span> Panel data: One geographical area, no autocorrelation</h3>
<pre><code>// STATA CODE
glm y yearminus2000 dailyrainfall cos365 sin365, family(poisson)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R CODE</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>yearMinus2000 <span class="sc">+</span> dailyrainfall <span class="sc">+</span> sin365 <span class="sc">+</span> cos365, <span class="at">data=</span>d, <span class="at">family=</span><span class="fu">poisson</span>())</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(fit1, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="panel-data-one-geographical-area-with-autocorrelation" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="panel-data-one-geographical-area-with-autocorrelation"><span class="header-section-number">1.2.2</span> Panel data: One geographical area, with autocorrelation</h3>
<pre><code>// STATA CODE
glm y yearminus2000 cos365 sin365, family(poisson) vce(robust)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R CODE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(y<span class="sc">~</span>yearMinus2000<span class="sc">+</span>sin365 <span class="sc">+</span> cos365, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> ID,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson, <span class="at">data =</span> d,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">correlation=</span>nlme<span class="sc">::</span><span class="fu">corAR1</span>(<span class="at">form=</span><span class="sc">~</span>dayOfSeries<span class="sc">|</span>ID))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit1, <span class="at">type =</span> <span class="st">"normalized"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="not-panel-data-multiple-geographical-areas" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="not-panel-data-multiple-geographical-areas"><span class="header-section-number">1.2.3</span> Not panel data: Multiple geographical areas</h3>
<pre><code>// STATA CODE
meglm y x yearMinus2000 || fylke:, family(poisson)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R CODE</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> lme4<span class="sc">::</span><span class="fu">glmer</span>(y<span class="sc">~</span>x <span class="sc">+</span> yearMinus2000 <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>fylke),<span class="at">data=</span>d,<span class="at">family=</span><span class="fu">poisson</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="panel-data-multiple-geographical-areas-no-autocorrelation" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="panel-data-multiple-geographical-areas-no-autocorrelation"><span class="header-section-number">1.2.4</span> Panel data: Multiple geographical areas, no autocorrelation</h3>
<pre><code>// STATA CODE
meglm y yearminus2000 cos365 sin365 || fylke:, family(poisson)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R CODE</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(y<span class="sc">~</span>yearMinus2000<span class="sc">+</span>sin365 <span class="sc">+</span> cos365, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> fylke,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson, <span class="at">data =</span> d)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit1, <span class="at">type =</span> <span class="st">"normalized"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="panel-data-multiple-geographical-areas-with-autocorrelation" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="panel-data-multiple-geographical-areas-with-autocorrelation"><span class="header-section-number">1.2.5</span> Panel data: Multiple geographical areas, with autocorrelation</h3>
<pre><code>// STATA CODE
meglm y yearminus2000 cos365 sin365 || fylke:, family(poisson) vce(robust)</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R CODE</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(y<span class="sc">~</span>yearMinus2000<span class="sc">+</span>sin365 <span class="sc">+</span> cos365, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> fylke,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson, <span class="at">data =</span> d,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">correlation=</span>nlme<span class="sc">::</span><span class="fu">corAR1</span>(<span class="at">form=</span><span class="sc">~</span>dayOfSeries<span class="sc">|</span>fylke))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit1, <span class="at">type =</span> <span class="st">"normalized"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="identifying-your-scenario" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="identifying-your-scenario"><span class="header-section-number">1.3</span> Identifying your scenario</h2>
<section id="step-1-do-you-have-panel-data" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="step-1-do-you-have-panel-data"><span class="header-section-number">1.3.1</span> Step 1: Do you have panel data?</h3>
<p>This step should be fairly simple. If your data has equally spaced time intervals between them, you have panel data.</p>
</section>
<section id="step-2-do-you-have-multiple-geographical-areas" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="step-2-do-you-have-multiple-geographical-areas"><span class="header-section-number">1.3.2</span> Step 2: Do you have multiple geographical areas?</h3>
<p>Again, fairly simple, just look at your data.</p>
</section>
<section id="step-3-do-you-have-autocorrelation" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="step-3-do-you-have-autocorrelation"><span class="header-section-number">1.3.3</span> Step 3: Do you have autocorrelation?</h3>
<p>Firstly, you must run a model pretending that you do not have autocorrelation.</p>
<p>You then inspect the residuals from the model and see if autocorrelation exists. This is done with two statistical procedures: <code>pacf</code> (for <code>autoregressive models</code>, the most common type of autocorrelation), and <code>acf</code> (for <code>moving average models</code>, a less common type of autocorrelation).</p>
<div style="page-break-after: always;"></div>
</section>
<section id="ar1-data" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="ar1-data"><span class="header-section-number">1.3.4</span> AR(1) data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="st">"ar"</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.5</span>)), <span class="at">rand.gen =</span> rnorm, <span class="at">n=</span><span class="dv">1000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code>autoregressive</code> data, a <code>pacf</code> plot contains a number of sharp significant lines, indicating how many subsequent observations have autocorrelation. i.e.&nbsp;if one line is significant, it means that each observation is only correlated with its preceeding observation (<code>AR(1)</code>). If two lines are significant, it means that each observation is correlated with its two preceeding observations (<code>AR(2)</code>). The following plot represents <code>AR(1)</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>With <code>autoregressive</code> data, an <code>acf</code> plot contains a number of decreasing lines. The following <code>acf</code> plot represents some sort of <code>AR</code> data. Note that the <code>acf</code> plot displays <code>lag 0</code> (which is pointless and can be ignored), while the <code>pacf</code> plot does not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="ar2-data" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="ar2-data"><span class="header-section-number">1.3.5</span> AR(2) data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="st">"ar"</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.4</span>)), <span class="at">rand.gen =</span> rnorm, <span class="at">n=</span><span class="dv">1000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following <code>pacf</code> plot represents <code>AR(2)</code> data. This means that each observation is correlated with its two preceeding observations (<code>AR(2)</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>The following <code>acf</code> plot represents some sort of <code>AR</code> data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="ma1-data" class="level3" data-number="1.3.6">
<h3 data-number="1.3.6" class="anchored" data-anchor-id="ma1-data"><span class="header-section-number">1.3.6</span> MA(1) data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="st">"ma"</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.9</span>)), <span class="at">rand.gen =</span> rnorm, <span class="at">n=</span><span class="dv">1000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With <code>moving average</code> data, a <code>pacf</code> plot contains a number of decreasing lines. The following <code>pacf</code> plot represents some sort of <code>MA</code> data.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>With <code>moving average</code> data, an <code>acf</code> plot contains a number of sharp significant lines, demarking how many subsequent observations have autocorrelation. i.e.&nbsp;if one line is significant, it means that each observation is only correlated with its preceeding observation. If two lines are significant, it means that each observation is correlated with its two preceeding observations. The following plot represents <code>MA(1)</code> data. Note that the <code>acf</code> plot displays <code>lag 0</code> (which is pointless and can be ignored), while the <code>pacf</code> plot does not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="ma2-data" class="level3" data-number="1.3.7">
<h3 data-number="1.3.7" class="anchored" data-anchor-id="ma2-data"><span class="header-section-number">1.3.7</span> MA(2) data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="st">"ma"</span><span class="ot">=</span><span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">0.6</span>)), <span class="at">rand.gen =</span> rnorm, <span class="at">n=</span><span class="dv">1000</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following <code>pacf</code> plot represents some sort of <code>MA</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>The following <code>acf</code> plot represents <code>MA(2)</code> data. This means that each observation is correlated with its two preceeding observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="100-reference_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Longitudinal Analysis for Surveillance</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/200-one-area-no-autocorrelation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Panel data: One area without autocorrelation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Written by <a href="https://www.rwhite.no">Richard Aubrey White</a>.</div>
  </div>
</footer>



</body></html>